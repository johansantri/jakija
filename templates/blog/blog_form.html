{% extends 'home/tes.html' %}
{% load static %}

{% block extra_head %}
<meta name="robots" content="noindex, nofollow">
{% endblock %}

{% block content %}
<section class="bg-white border border-gray-300 p-4 sm:p-6 lg:p-8 rounded-xl shadow-sm mt-6 mx-2 sm:mx-0">
  <div class="bg-white rounded-lg shadow-sm">
    <div class="p-6">
      <h1 class="text-3xl font-bold mb-6">
        {% if form.instance.pk %}
          Edit Blog Post
        {% else %}
          Create New Blog Post
        {% endif %}
      </h1>

      <!-- Tampilkan pesan sukses/error -->
      {% if messages %}
        {% for message in messages %}
          <div class="mb-6 flex items-center justify-between rounded-lg px-4 py-3 
            {% if message.tags == 'success' %}bg-green-100 text-green-800 border-l-4 border-green-500
            {% elif message.tags == 'error' %}bg-red-100 text-red-800 border-l-4 border-red-500
            {% else %}bg-blue-100 text-blue-800 border-l-4 border-blue-500{% endif %}">
            <span>{{ message }}</span>
            <button type="button" onclick="this.parentElement.remove()" class="text-xl font-bold">&times;</button>
          </div>
        {% endfor %}
      {% endif %}

      <!-- Tampilkan error global jika ada -->
      {% if form.errors %}
        <div class="mb-6 rounded-lg bg-red-50 p-4 text-red-800 border border-red-300">
          <ul class="list-disc pl-5 space-y-1">
            {% for field in form %}
              {% for error in field.errors %}
                <li><strong>{{ field.label }}:</strong> {{ error }}</li>
              {% endfor %}
            {% endfor %}
            {% for error in form.non_field_errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}

      <form method="POST" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}

        <!-- Title -->
        <div>
          <label for="{{ form.title.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
            Title
          </label>
          {{ form.title }}
          {% if form.title.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.title.errors|join:", " }}</p>
          {% endif %}
        </div>

        <!-- Content -->
        <div>
          <label for="{{ form.content.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
            Content
          </label>
          {{ form.content }}
          {% if form.content.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.content.errors|join:", " }}</p>
          {% endif %}
        </div>

        <!-- Image + Preview -->
        <div class="flex flex-col sm:flex-row gap-6 items-start">
          <div class="flex-1">
            <label for="{{ form.image.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
              Image
            </label>
            {{ form.image }}
            {% if form.image.errors %}
              <p class="mt-1 text-sm text-red-600">{{ form.image.errors|join:", " }}</p>
            {% endif %}
          </div>

          <!-- Preview -->
          <div class="w-40">
            {% if form.instance.image %}
              <img id="imagePreview" src="{{ form.instance.image.url }}" alt="Preview" class="h-32 w-32 object-cover border rounded shadow-sm" />
            {% else %}
              <img id="imagePreview" src="#" alt="Preview" class="h-32 w-32 object-cover border rounded shadow-sm hidden" />
            {% endif %}
          </div>
        </div>

        <!-- Category -->
        <div>
          <label for="{{ form.category.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
            Category
          </label>
          {{ form.category }}
          {% if form.category.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.category.errors|join:", " }}</p>
          {% endif %}
        </div>

        <!-- Tags -->
        <div>
          <label for="{{ form.tags.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
            Tags
          </label>
          {{ form.tags }}
          <p class="mt-1 text-sm text-gray-500">
            Hold Ctrl (or Cmd) to select multiple tags.
          </p>
          {% if form.tags.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.tags.errors|join:", " }}</p>
          {% endif %}
        </div>

        <!-- Status -->
        <div>
          <label for="{{ form.status.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
            Status
          </label>
          {{ form.status }}
          {% if form.status.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.status.errors|join:", " }}</p>
          {% endif %}
        </div>

        <!-- Tombol Aksi -->
        <div class="flex items-center gap-4 pt-6">
          <button type="submit" class="rounded-lg bg-blue-600 px-6 py-2.5 text-white font-medium hover:bg-blue-700 transition">
            Save
          </button>
          <a href="{% url 'blog:blog-list-admin' %}" 
             class="rounded-lg border border-gray-300 px-6 py-2.5 text-gray-700 font-medium hover:bg-gray-50 transition">
            Cancel
          </a>
        </div>
      </form>
    </div>
  </div>
</section>

<!-- Optional: Script untuk preview gambar saat upload -->
<script>
  const imageInput = document.getElementById('id_image');
  const imagePreview = document.getElementById('imagePreview');

  if (imageInput && imagePreview) {
    imageInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          imagePreview.src = e.target.result;
          imagePreview.classList.remove('hidden');
        }
        reader.readAsDataURL(file);
      }
    });
  }
</script>
{% endblock %}