{% extends 'home/tes.html' %}
{% load static %}

{% block content %}


<section class="bg-white border border-gray-200 p-6 rounded-lg shadow-sm hover:shadow-md transition">
      <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-4 gap-4">
        <h3 class="text-lg font-semibold text-gray-800 border-l-4 border-red-300 pl-2">{{ course.course_name }}</h3>
        <a href="{% url 'learner:score_summary_detail' course_id=course.id %}?download=csv" 
               class="bg-red-400 text-white px-4 py-2 rounded-lg hover:bg-red-500 transition text-sm">
                Export to CSV
            </a>
      </div>

  

        <!-- Body -->
        <div class="p-4 sm:p-6">
            {% if user_scores %}
                <!-- Loop untuk setiap peserta -->
                {% for user_score in user_scores %}
                    <!-- Header untuk setiap peserta -->
                    <div class="mt-6 mb-4">
                        <h5 class="text-lg font-bold text-blue-700 flex items-center gap-2">
                            {{ user_score.user.username }} | {{ user_score.user.email }}
                        </h5>
                        <hr class="border-blue-600 border-2 mt-2">
                    </div>

                    <!-- Tabel responsif untuk asesmen peserta -->
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-800 text-white">
                                <tr>
                                    <th class="py-3 px-4 text-left font-medium">Assessment</th>
                                    <th class="py-3 px-4 text-left font-medium">Score</th>
                                    <th class="py-3 px-4 text-left font-medium">Max Score</th>
                                    <th class="py-3 px-4 text-left font-medium">Overall %</th>
                                    <th class="py-3 px-4 text-left font-medium">Status</th>
                                    <th class="py-3 px-4 text-left font-medium">Grade</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for result in user_score.assessment_results %}
                                <tr class="border-b hover:bg-gray-50 transition
                                    {% cycle 'bg-white' 'bg-gray-50' %}">
                                    <td class="py-3 px-4">{{ result.name }}</td>
                                    <td class="py-3 px-4">{{ result.score|floatformat:2 }}</td>
                                    <td class="py-3 px-4">{{ result.max_score }}</td>
                                    {% if forloop.last %}
                                    <td class="py-3 px-4 font-medium text-blue-700">
                                        {{ user_score.overall_percentage }}%
                                    </td>
                                    <td class="py-3 px-4">
                                        <span class="inline-flex px-3 py-1 rounded-full text-xs font-bold
                                            {% if user_score.status == 'Pass' %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                                            {{ user_score.status }}
                                        </span>
                                    </td>
                                    <td class="py-3 px-4 font-medium">{{ user_score.grade }}</td>
                                    {% else %}
                                    <td class="py-3 px-4"></td>
                                    <td class="py-3 px-4"></td>
                                    <td class="py-3 px-4"></td>
                                    {% endif %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% empty %}
                    <div class="bg-blue-50 border border-blue-200 text-blue-700 p-4 rounded-lg text-center">
                        No participants enrolled in this course.
                    </div>
                {% endfor %}
            {% else %}
                <div class="bg-blue-50 border border-blue-200 text-blue-700 p-4 rounded-lg text-center">
                    No participants enrolled in this course.
                </div>
            {% endif %}
        </div>
    </div>

</section>

{% endblock %}