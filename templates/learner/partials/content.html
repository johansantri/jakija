{% load learner_tags %}
{% load static %}

<main class="min-h-screen bg-gray-50" id="content-area">

{% if current_content %}

    {% if current_content.0 == 'material' %}
        {% with material=current_content.1 %}
        <article class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12">
            <h3 class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-8 text-gray-800 leading-tight">
                {{ material.title }}
            </h3>
            <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 lg:p-12 prose prose-lg lg:prose-xl max-w-none text-gray-700">
                {{ material.description|make_iframes_responsive|safe }}
            </div>
            <div class="mt-12 lg:mt-16">
                {% include 'learner/partials/comments.html' %}
            </div>
        </article>
        {% endwith %}

    {% elif current_content.0 == 'assessment' %}
        {% with assessment=current_content.1 %}
        <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12">

            {% if assessment_locked %}
            <div class="bg-yellow-50 border-l-4 border-yellow-400 rounded-2xl p-6 lg:p-10 flex flex-col lg:flex-row items-center justify-between gap-6">
                <div class="flex items-center gap-5">
                    <i class="bi bi-exclamation-triangle-fill text-5xl lg:text-7xl text-yellow-600"></i>
                    <div>
                        <h5 class="text-2xl lg:text-3xl font-bold text-gray-800">Payment Required</h5>
                        <p class="text-lg text-gray-600 mt-2">This exam requires payment before it can be started.</p>
                    </div>
                </div>
                <a href="{{ payment_required_url }}" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold px-8 py-4 rounded-xl text-lg lg:text-xl shadow-lg transition whitespace-nowrap">
                    Checkout Now
                </a>
            </div>
            {% else %}

                {% if ask_oras %}
                <div class="bg-white rounded-2xl shadow-xl p-6 lg:p-10">
                    <h4 class="text-2xl sm:text-3xl lg:text-4xl font-bold mb-10 text-indigo-700">Open Response Assessment</h4>
                    {% for ask_ora in ask_oras %}
                    <div class="border border-gray-200 rounded-xl p-6 lg:p-8 mb-8 bg-gray-50">
                        <h5 class="text-xl lg:text-2xl font-semibold text-gray-800">{{ ask_ora.title }}</h5>
                        <div class="my-5 prose prose-indigo">{{ ask_ora.question_text|safe }}</div>
                        <p class="text-sm lg:text-base text-gray-600 mb-5">Deadline: {{ ask_ora.response_deadline|date:"d M Y H:i" }}</p>
                        {% if askora_can_submit|dict_get:ask_ora.id %}
                        <form method="POST" hx-post="{% url 'learner:submit_answer_askora_new' ask_ora.id %}" hx-target="#content-area" hx-swap="innerHTML" enctype="multipart/form-data" class="space-y-6">
                            {% csrf_token %}
                            <textarea name="answer_text" rows="8" required class="w-full border border-gray-300 rounded-lg p-4 text-base lg:text-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Tulis jawaban Anda di sini..."></textarea>
                            <input type="file" name="answer_file" class="block w-full text-sm lg:text-base">
                            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg shadow transition text-base lg:text-lg">
                                Submit Answer
                            </button>
                        </form>
                        {% else %}
                        <div class="bg-red-100 border border-red-300 text-red-700 px-6 py-4 rounded-lg font-medium text-base lg:text-lg">
                            Submission period has closed.
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- IN-VIDEO QUIZ: VERSI ULTIMATE (Video.js + GSAP + Sound + Score + Super Cantik) -->
                 {% if is_video_quiz and video %}
                 <h1 class="sr-only">{{ video.title }}</h1>
                        <style>
                            .quiz-overlay{
                                position:fixed; inset:0;
                                background:rgba(0,0,0,0.85);
                                backdrop-filter:blur(15px);
                                opacity:0; pointer-events:none;
                                transition:opacity .35s ease;
                                z-index:50;
                                display:flex; align-items:center; justify-content:center;
                                padding:1.5rem; overflow-y:auto;
                            }
                            .quiz-overlay.active{
                                opacity:1; pointer-events:all;
                            }

                            .quiz-card{
                                background:rgba(255,255,255,0.96);
                                border-radius:1.75rem;
                                padding:2rem;
                                width:100%; max-width:480px;
                                box-shadow:0 25px 60px -12px rgba(0,0,0,0.45);
                                transform:scale(.9); opacity:0;
                            }

                            /* Buttons */
                            .quiz-option{
                                @apply w-full p-4 text-left rounded-xl font-medium transition-all cursor-pointer;
                                background:#f8fafc;
                                border:2px solid transparent;
                            }
                            .quiz-option:hover{
                                background:#eef2ff;
                                border-color:#c7d2fe;
                                transform:translateY(-2px);
                                box-shadow:0 6px 16px rgba(0,0,0,0.15);
                            }

                            .quiz-btn-true{
                                @apply w-full p-5 text-2xl font-bold rounded-xl text-white transition;
                                background:#10b981;
                            }
                            .quiz-btn-true:hover{ background:#059669; }

                            .quiz-btn-false{
                                @apply w-full p-5 text-2xl font-bold rounded-xl text-white transition;
                                background:#ef4444;
                            }
                            .quiz-btn-false:hover{ background:#dc2626; }

                            .finish-card-icon{
                                filter: drop-shadow(0px 8px 12px rgba(255,200,0,0.7));
                            }
                        </style>
                    
                        <div class="relative w-full max-w-10xl shadow-2xl rounded-2xl overflow-hidden bg-black">
                            
                            <video id="myVideo" data-id="{{ video.id }}" data-assessment="{{ assessment.id }}" class="w-full" controls preload="auto">
                                <source src="{{ video.file.url }}" type="video/mp4">
                                browser not suport.
                            </video>

                            <div class="absolute top-4 left-4 bg-black/70 backdrop-blur px-5 py-3 rounded-full flex items-center gap-3 z-50">
                                <i class="fas fa-trophy text-yellow-400 text-xl"></i>
                                <span id="scoreDisplay" class="font-bold text-xl">0 / 0</span>
                            </div>

                            <div id="quizOverlay" class="quiz-overlay">
                                <div class="quiz-card">
                                    <h2 id="questionText" class="text-xl md:text-2xl font-bold text-center mb-6 leading-relaxed"></h2>
                                    <div id="optionsContainer" class="space-y-4 mb-6"></div>
                                    <div id="explanation" class="p-4 bg-green-100 rounded-xl text-green-800 font-medium hidden"></div>
                                    <button id="nextButton" class="w-full mt-6 bg-red-500 hover:bg-red-600 text-white font-bold py-5 rounded-full text-lg shadow-lg transition transform hover:scale-105">
                                        Continue Video
                                    </button>
                                </div>
                            </div>
                        </div>

                        <audio id="correctSound">
                        <source src="{% static 'sounds/correct-156911.mp3' %}" type="audio/mp3">
                        </audio>
                        <audio id="wrongSound">
                        <source src="{% static 'sounds/error-mistake-sound-effect-incorrect-answer-437420.mp3' %}" type="audio/mp3">
                        </audio>
                    <!--invideoquiz-->
                    <script>
                        const quizzes = {{ quizzes_json|safe }};
                        let currentQuiz = 0;
                        let score = 0;
                        let answeredQuizzes = {};

                        function getCSRFToken() {
                            const name = "csrftoken=";
                            const cookies = document.cookie.split(';');
                            for (let cookie of cookies) {
                                cookie = cookie.trim();
                                if (cookie.startsWith(name)) {
                                    return cookie.substring(name.length);
                                }
                            }
                            return null;
                        }


                        // console.log(getCSRFToken());  // Cek apakah token CSRF diambil dengan benar





                        const video = document.getElementById('myVideo');
                        const overlay = document.getElementById('quizOverlay');
                        const quizCard = document.querySelector('.quiz-card');
                        const questionText = document.getElementById('questionText');
                        const optionsContainer = document.getElementById('optionsContainer');
                        const nextButton = document.getElementById('nextButton');
                        const explanation = document.getElementById('explanation');
                        const scoreDisplay = document.getElementById('scoreDisplay');

                        const result = JSON.parse('{{ result_json|default:"null"|escapejs }}');

                        // Jika user pernah submit sebelumnya
                        if(result){
                            score = result.score || 0;
                            if(result.answers){
                                Object.keys(result.answers).forEach(index => {
                                    answeredQuizzes[index] = {
                                        answered: true,
                                        correct: result.answers[index].correct,
                                        userAnswer: result.answers[index].answer,
                                        shown: false // overlay belum ditampilkan
                                    };
                                });
                            }
                            updateScoreDisplay();
                        }

                        // Fungsi main
                        function playSound(correct){
                            const s = correct ? document.getElementById('correctSound') : document.getElementById('wrongSound');
                            s.pause(); s.currentTime=0; s.play().catch(()=>{});
                        }

                        function updateScoreDisplay(){
                            const answeredCount = Object.keys(answeredQuizzes).length;
                            scoreDisplay.textContent = `${score} / ${answeredCount}`;
                        }

                        // Tampilkan quiz
                        function showQuiz(index){
                            const q = quizzes[index];
                            video.pause();
                            overlay.classList.add('active');
                            gsap.to(quizCard, {scale:1, opacity:1, duration:0.6, ease:"back.out(1.7)"});
                            questionText.textContent = q.question;
                            optionsContainer.innerHTML = '';
                            explanation.classList.add('hidden');
                            nextButton.classList.add('hidden');

                            const alreadyAnswered = answeredQuizzes[index] || {answered:false, correct:false};

                            // Jika sudah dijawab sebelumnya, tampilkan jawaban disable
                            if(alreadyAnswered.answered){
                                if(q.type === "multiple-choice"){
                                    q.options.forEach((opt,i)=>{
                                        const b = document.createElement('button');
                                        b.className = "w-full p-4 text-center bg-gray-100 rounded-xl font-medium transition text-base md:text-lg";
                                        b.textContent = opt;
                                        if(i === q.correct) b.classList.add("bg-green-500");
                                        if(alreadyAnswered.userAnswer === i && !alreadyAnswered.correct) b.classList.add("bg-red-500","text-white");
                                        b.disabled = true;
                                        optionsContainer.appendChild(b);
                                    });
                                } else if(q.type === "true-false"){
                                    ["incorrect","correct"].forEach(label=>{
                                        const btn = document.createElement('button');
                                        btn.className = `w-full p-6 text-2xl font-bold rounded-xl ${label==="correct"?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"} text-white`;
                                        btn.textContent = label;
                                        btn.disabled = true;
                                        if(alreadyAnswered.userAnswer === label && !alreadyAnswered.correct){
                                            btn.classList.remove("bg-green-500","bg-red-500");
                                            btn.classList.add("bg-red-500","text-white");
                                        }
                                        optionsContainer.appendChild(btn);
                                    });
                                } else if(q.type==="fill-blank" || q.type==="es"){
                                    const input = document.createElement('input');
                                    input.type="text";
                                    input.value = alreadyAnswered.userAnswer || "";
                                    input.disabled = true;
                                    input.className = "w-full p-5 text-xl text-center border-4 border-gray-300 rounded-xl outline-none " + (alreadyAnswered.correct?"bg-green-500 text-white":"bg-red-500 text-white");
                                    optionsContainer.appendChild(input);
                                } else if(q.type==="drag-and-drop"){
                                    const drop = document.createElement('div');
                                    drop.className = "border-4 border-dashed border-green-500 rounded-2xl h-32 mb-6 flex items-center justify-center text-lg font-bold";
                                    drop.textContent = alreadyAnswered.userAnswer || "Answer: " + q.correct;
                                    optionsContainer.appendChild(drop);
                                }

                                explanation.textContent = q.explanation || "";
                                explanation.classList.remove('hidden');
                                nextButton.classList.remove('hidden');
                                return; // jangan buat tombol submit lagi
                            }

                            // Jika belum dijawab, tampilkan tombol submit (normal)
                            function handleAnswer(correct, el){
                                if(alreadyAnswered.answered) return;
                                alreadyAnswered.answered = true;
                                alreadyAnswered.correct = correct;
                                answeredQuizzes[index] = alreadyAnswered;
                                if(correct) score++;
                                playSound(correct);
                                if(el) el.classList.add(correct ? "bg-green-500" : "bg-red-500","text-white");
                                explanation.textContent = q.explanation || "";
                                explanation.classList.remove('hidden');
                                nextButton.classList.remove('hidden');
                                updateScoreDisplay();
                            }

                            if(q.type==="multiple-choice"){
                                q.options.forEach((opt,i)=>{
                                    const b = document.createElement('button');
                                    b.className = "w-full p-4 text-center bg-blue-100 hover:bg-gray-200 rounded-xl font-medium transition text-base md:text-lg";
                                    b.textContent = opt;
                                    b.onclick=()=>handleAnswer(i===q.correct,b);
                                    optionsContainer.appendChild(b);
                                });
                            } else if(q.type === "true-false"){
                                const trueButton = document.createElement('button');
                                trueButton.className = "w-full p-6 text-2xl font-bold rounded-xl bg-red-500 hover:bg-red-600 text-white";
                                trueButton.textContent="incorrect";

                                const falseButton = document.createElement('button');
                                falseButton.className = "w-full p-6 text-2xl font-bold rounded-xl bg-green-500 hover:bg-green-600 text-white";
                                falseButton.textContent="correct";

                                const correctAnswer = String(q.correct).toLowerCase() === "true" || String(q.correct).toLowerCase() === "correct";
                                trueButton.onclick = () => handleAnswer(correctAnswer === true, trueButton);
                                falseButton.onclick = () => handleAnswer(correctAnswer === false, falseButton);

                                optionsContainer.appendChild(trueButton);
                                optionsContainer.appendChild(falseButton);
                            } else if(q.type==="fill-blank" || q.type==="es"){
                                const input = document.createElement('input');
                                input.type="text"; input.autofocus=true; input.placeholder="Type your answer...";
                                input.className = "w-full p-5 text-xl text-center border-4 border-gray-300 rounded-xl focus:border-emerald-500 outline-none";
                                const sub = document.createElement('button');
                                sub.textContent="Submit"; sub.className = "mt-4 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-full";
                                sub.onclick = ()=>handleAnswer(input.value.trim().toLowerCase()===q.correct.toLowerCase(),input);
                                input.addEventListener("keydown", e=> e.key==="Enter" && sub.click());
                                optionsContainer.appendChild(input); 
                                optionsContainer.appendChild(sub);
                            } else if(q.type==="drag-and-drop"){
                                const drop=document.createElement('div');
                                drop.className="border-4 border-dashed border-green-500 rounded-2xl h-32 mb-6 flex items-center justify-center text-lg font-bold";
                                drop.textContent="Drop here";
                                drop.ondragover=e=>e.preventDefault();
                                drop.ondrop=e=>{ e.preventDefault(); handleAnswer(e.dataTransfer.getData("text")===q.correct,drop); };
                                optionsContainer.appendChild(drop);

                                const items=document.createElement('div'); items.className="grid grid-cols-2 gap-4";
                                q.items.forEach(item=>{
                                    const el=document.createElement('div');
                                    el.className="bg-green-600 text-white p-5 rounded-xl text-center cursor-move select-none text-base md:text-lg";
                                    el.textContent=item; el.draggable=true;
                                    el.ondragstart=e=>e.dataTransfer.setData("text",item);
                                    items.appendChild(el);
                                });
                                optionsContainer.appendChild(items);
                            }
                        }

                        // Tombol Next
                        nextButton.onclick=()=>{
                            overlay.classList.remove('active');
                            currentQuiz++;
                            if(currentQuiz<quizzes.length) video.play();
                            else endQuiz();
                        };

                        // Simpan hasil dan tampilkan UI akhir
                        // Simpan hasil dan tampilkan UI akhir
                        // Fungsi untuk melanjutkan menonton video
                        // Fungsi untuk melanjutkan menonton video dan menyembunyikan overlay
                        function continueWatching() {
                        const video = document.getElementById('myVideo');
                        const overlay = document.getElementById('quizOverlay');
                        const quizCard = document.querySelector('.quiz-card');

                        if (video.paused) {
                            video.play();  // Lanjutkan video jika belum selesai
                        }

                        // Sembunyikan overlay dan quiz card
                        overlay.classList.remove('active'); // Menghapus class 'active' untuk menyembunyikan overlay
                        quizCard.classList.add('hidden');   // Menambahkan class 'hidden' untuk menyembunyikan quiz card
                        }


                        function endQuiz() {
                        const csrfToken = getCSRFToken();
                        //console.log("CSRF Token:", csrfToken); // Cek token CSRF yang diambil
                        const videoEl = document.getElementById("myVideo");

                        // ðŸ”¥ JANGAN LUPA INI
                        const assessmentId = videoEl.dataset.assessment;

                        // console.log("Assessment ID:", assessmentId);
                        overlay.classList.add('active');
                        fetch(`/video/${videoEl.dataset.id}/save-result/${assessmentId}/`, {
                            method: "POST",
                            credentials: "same-origin", 
                            headers: {
                                "Content-Type": "application/json",
                                "X-CSRFToken": getCSRFToken(),
                            },
                            body: JSON.stringify({
                                score: score,
                                total: quizzes.length,
                                answers: answeredQuizzes
                            })
                        })
                        .then(res => {
                            if (!res.ok) {
                                return res.text().then(text => {throw new Error(text)});
                            }
                            return res.json();
                        })
                        .then(data => {
                            console.log("Saved:", data);
                        })
                        .catch(error => {
                            console.error("Request failed:", error);
                            alert('CSRF Token Error or server issue. ' + error.message);
                        });

                        quizCard.innerHTML = `
                            <div class="text-center py-12">
                                <i class="fas fa-trophy text-8xl text-yellow-400 mb-6"></i>
                                <h2 class="text-4xl font-bold mb-4">Done !</h2>
                                <p class="text-6xl font-black text-green-400">${score}/${quizzes.length}</p>
                                <button onclick="continueWatching()" class="mt-8 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-5 rounded-full text-xl">Continue Watching Until Finished</button>
                            </div>`;
                        }





                        // Event video timeupdate
                        video.addEventListener('timeupdate', ()=>{
                            quizzes.forEach((q,index)=>{
                                if(video.currentTime >= q.time && !answeredQuizzes[index]?.shown){
                                    answeredQuizzes[index] = answeredQuizzes[index] || {};
                                    answeredQuizzes[index].shown = true;
                                    showQuiz(index);
                                }
                            });
                        });
                    </script>
                            <!-- endvideo quiz -->

                            
                        {% endif %}



                            <!-- AKHIR IN-VIDEO QUIZ ULTIMATE -->

                        {% if is_quiz and is_started and not is_expired %}
                        <div class="sticky top-0 bg-white shadow-2xl z-50 p-4 lg:p-6 mb-10 rounded-2xl border border-gray-200">
                            <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                                <span class="text-lg lg:text-xl font-semibold text-gray-700">
                                    Remaining Time: <span id="timer-countdown" class="text-3xl lg:text-4xl font-bold text-red-600">{{ remaining_time }}</span>s
                                </span>
                                <span id="progress-percent" class="text-base lg:text-lg font-medium text-gray-600">100%</span>
                            </div>
                            <div class="w-full bg-gray-300 rounded-full h-8 lg:h-10 mt-3 overflow-hidden">
                                <div id="timer-progress" class="bg-gradient-to-r from-blue-500 to-blue-700 h-full rounded-full transition-all duration-1000 flex items-center justify-end pr-4">
                                    <span class="text-white font-bold text-sm lg:text-base">100%</span>
                                </div>
                            </div>
                        </div>

                        <form id="quiz-form" hx-post="{% url 'learner:submit_assessment_new' assessment.id %}" hx-target="#content-area" hx-swap="innerHTML" method="POST" class="space-y-10">
                            {% csrf_token %}
                            {% for question in assessment.questions.all|shuffled %}
                            <div class="bg-white p-6 lg:p-10 rounded-2xl shadow-xl border border-gray-200">
                                <h5 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-8 text-gray-800 leading-tight">
                                    {{ forloop.counter }}. {{ question.text|safe }}
                                </h5>
                                <div class="space-y-5">
                                    {% for choice in question.choices.all|shuffled %}
                                    {% with answered=answered_questions|get_item:question.id %}
                                    <label class="flex items-start gap-5 cursor-pointer p-5 lg:p-6 rounded-xl hover:bg-gray-50 transition border border-gray-200">
                                        <input type="radio" name="answers_{{ question.id }}" value="{{ choice.id }}"
                                            class="mt-1 w-5 h-5 lg:w-6 lg:h-6 text-indigo-600 focus:ring-indigo-500"
                                            {% if answered and answered.choice.id == choice.id %}checked{% endif %}>
                                        <span class="text-base sm:text-lg lg:text-xl text-gray-700 leading-relaxed flex-1">{{ choice.text|safe }}</span>
                                    </label>
                                    {% endwith %}
                                    {% endfor %}
                                </div>
                            </div>
                            {% endfor %}

                            <div class="text-center mt-16">
                                <button type="submit" class="bg-red-600 hover:bg-red-700 text-white font-bold text-xl sm:text-2xl lg:text-3xl px-12 lg:px-20 py-5 lg:py-7 rounded-xl shadow-2xl transition transform hover:scale-105">
                                    Submit All Answers
                                </button>
                            </div>
                        </form>

                        <script>
                        (function () {
                            const timerEl = document.getElementById('timer-countdown');
                            const progress = document.getElementById('timer-progress');
                            const percentEl = document.getElementById('progress-percent');
                            if (!timerEl) return;
                            let total = parseInt(timerEl.textContent);
                            let left = total;
                            const iv = setInterval(() => {
                                left--;
                                const pct = Math.round((left / total) * 100);
                                timerEl.textContent = left;
                                progress.style.width = pct + '%';
                                percentEl.textContent = pct + '%';
                                progress.querySelector('span').textContent = pct + '%';
                                if (pct <= 25) progress.classList.replace('from-blue-500', 'from-red-500');
                                else if (pct <= 50) progress.classList.replace('from-blue-500', 'from-yellow-500');
                                if (left <= 0) {
                                    clearInterval(iv);
                                    document.querySelectorAll('#quiz-form input[type=radio]').forEach(i => i.disabled = true);
                                    htmx.trigger('#quiz-form', 'submit');
                                }
                            }, 1000);
                        })();
                    </script>
                {% endif %}

                {% if is_lti and lti_tool %}
                <div class="text-center py-24 lg:py-32 bg-gradient-to-b from-indigo-50 to-white rounded-3xl">
                    <h4 class="text-4xl sm:text-5xl lg:text-6xl font-bold mb-8 text-gray-800">{{ lti_tool.tool_name }}</h4>
                    <p class="text-lg lg:text-xl text-gray-600 mb-12 max-w-2xl mx-auto">Klik tombol di bawah untuk membuka alat eksternal.</p>
                    <form action="{% url 'learner:lti_consume_course' assessment.id %}" method="get" target="_blank">
                        <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-2xl lg:text-4xl px-20 lg:px-32 py-8 lg:py-12 rounded-xl shadow-2xl transition transform hover:scale-105">
                            Launch LTI Tool
                        </button>
                    </form>
                </div>
                {% endif %}

                {% if is_quiz and not is_started and not assessment_locked %}
                <div class="text-center py-32 lg:py-40 bg-gradient-to-br from-purple-50 to-indigo-50 rounded-3xl">
                    <h3 class="text-4xl sm:text-5xl lg:text-6xl font-bold mb-10 text-gray-800">{{ assessment.title|safe }}</h3>
                    <p class="text-xl lg:text-2xl text-gray-600 mb-16">Siap untuk memulai kuis?</p>
                    <form method="POST" hx-post="{% url 'learner:start_assessment' assessment.id %}" hx-target="#content-area" hx-swap="innerHTML">
                        {% csrf_token %}
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold text-3xl lg:text-5xl px-20 lg:px-32 py-10 lg:py-16 rounded-xl shadow-2xl transition transform hover:scale-110">
                            Start Quiz Now
                        </button>
                    </form>
                </div>
                {% endif %}

            {% endif %}
        </div>
        {% endwith %}
    {% endif %}

    <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 mt-16 lg:mt-24">
        {% include 'learner/partials/navigation.html' %}
    </div>

{% else %}
    <div class="text-center py-32 lg:py-48">
        <p class="text-2xl lg:text-3xl text-gray-500">Please select a material or assessment from the sidebar.</p>
    </div>
{% endif %}

</main>

<!-- Welcome Modal (tetap sama, sudah responsif) -->
{% if messages %}
<div class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4" id="welcomeModal">
    <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full overflow-hidden">
        <div class="p-8 text-center">
            <button onclick="document.getElementById('welcomeModal').remove()" class="float-right text-gray-500 hover:text-gray-700">
                <i class="bi bi-x-lg text-3xl"></i>
            </button>
            {% for message in messages %}
                <div class="prose prose-lg max-w-none text-gray-700">{{ message|safe }}</div>
            {% endfor %}
        </div>
        <div class="bg-gray-50 px-8 py-6 flex flex-col sm:flex-row gap-4">
            <button onclick="window.location.href='{% url 'courses:course_lms_detail' course.id course.slug %}'"
                    class="flex-1 py-4 border-2 border-gray-300 rounded-xl font-semibold hover:bg-gray-100 transition text-base lg:text-lg">
                View Course Details
            </button>
            <button onclick="document.getElementById('welcomeModal').remove()"
                    class="flex-1 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-bold hover:from-indigo-700 hover:to-purple-700 transition shadow-lg text-base lg:text-lg">
                Start Learning!
            </button>
        </div>
    </div>
</div>
{% endif %}

<script src="{% static 'js/pingSession.js' %}"></script>