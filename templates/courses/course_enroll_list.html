{% extends 'home/tes.html' %}
{% load static %}

{% block content %}

<section class="bg-white border border-gray-200 p-6 rounded-lg shadow-sm hover:shadow-md transition">
      <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-4 gap-4">
        <h3 class="text-lg font-semibold text-gray-800 border-l-4 border-red-300 pl-2">{{ course.course_name }}</h3>
        
      </div>

   

    <!-- Formulir Pencarian -->
    <form method="GET" class="mb-4">
        <div class="flex flex-col sm:flex-row gap-2 shadow-sm">
            <input 
                type="text" 
                name="search" 
                placeholder="Cari berdasarkan nama..." 
                value="{{ search_query }}" 
                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
            <button type="submit" 
                    class="px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-1">
                Search
            </button>
        </div>
    </form>

    <!-- Tombol Ekspor & Navigasi -->
    <div class="flex flex-col sm:flex-row justify-start gap-3 mb-4">
        <a href="?download=csv{% if search_query %}&search={{ search_query }}{% endif %}" 
        class="px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition shadow-sm flex items-center justify-center gap-1">
            Download CSV
        </a>
        <button 
            type="button" 
            onclick="document.getElementById('inviteModal').classList.remove('hidden')"
            class="px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition shadow-sm flex items-center gap-1">
            Invite Learner
        </button>
        <a href="{% url 'learner:score_summary_detail' course_id=course.id %}" 
        class="px-4 py-2 bg-white border-2 border-blue-600 text-blue-600 font-medium rounded-lg hover:bg-blue-50 transition shadow-sm flex items-center justify-center gap-1">
            View Score Summary Detail
        </a>
    </div>



    <!-- Modal -->
    <div id="inviteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative">
            <h2 class="text-lg font-semibold mb-4">Invite Learner</h2>
            <form method="POST" action="{% url 'learner:invite_learner' course_id=course.id %}">
                {% csrf_token %}
                <div class="mb-4">
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Learner Email</label>
                   <textarea name="emails" id="emails" rows="4" required
                    class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="user1@example.com, user2@example.com"></textarea>
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" onclick="document.getElementById('inviteModal').classList.add('hidden')"
                            class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition">Cancel</button>
                    <button type="submit"
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">Invite</button>
                </div>
            </form>
            <button onclick="document.getElementById('inviteModal').classList.add('hidden')"
                    class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
    </div>



    <!-- Tabel Pendaftaran -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead class="bg-gray-800 text-white text-center">
                    <tr class="text-xs">
                        <th class="py-3 px-2">Name</th>
                        <th class="py-3 px-2">Email</th>
                        <th class="py-3 px-2">Gender</th>
                        <th class="py-3 px-2">Birth</th>
                        <th class="py-3 px-2">Address</th>
                        <th class="py-3 px-2">Country</th>
                        <th class="py-3 px-2">Phone</th>
                        <th class="py-3 px-2">Education</th>
                        <th class="py-3 px-2">University</th>
                        <th class="py-3 px-2">Score</th>
                        <th class="py-3 px-2">Status</th>
                        <th class="py-3 px-2">Progress</th>
                        <th class="py-3 px-2">Percentage</th>
                        <th class="py-3 px-2">Material</th>
                        <th class="py-3 px-2">Completed</th>
                        <th class="py-3 px-2">Last Login</th>
                    </tr>
                </thead>
                <tbody>
                    {% for detail in enrollments %}
                    <tr class="border-b hover:bg-gray-50 transition">
                        <td class="py-2 px-2 font-medium">
                            <a href="{% url 'instructor:instructor_learner_detail_report' %}?learner_id={{ detail.user.id }}" class="text-blue-600 hover:underline">
                                {{ detail.first_name }} {{ detail.last_name }} 
                            </a>
                        </td>
                        <td class="py-2 px-2">{{ detail.email|default:"-" }}</td>
                        <td class="py-2 px-2">{{ detail.gender|default:"-" }}</td>
                        <td class="py-2 px-2">{{ detail.birth|date:"d M, Y"|default:"-" }}</td>
                        <td class="py-2 px-2">{{ detail.address|truncatechars:20|default:"-" }}</td>
                        <td class="py-2 px-2">{{ detail.country|default:"-" }}</td>
                        <td class="py-2 px-2">{{ detail.phone|default:"-" }}</td>
                        <td class="py-2 px-2">{{ detail.education|default:"-" }}</td>
                        <td class="py-2 px-2">{{ detail.university|default:"-" }}</td>
                        <td class="py-2 px-2 font-medium">{{ detail.total_score }} / {{ detail.total_max_score }}</td>
                        <td class="py-2 px-2">
                            <span class="inline-block px-2 py-1 rounded-full text-xs font-medium
                                {% if detail.status == 'Pass' %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                                {{ detail.status }}
                            </span>
                        </td>
                        <td class="py-2 px-2">{{ detail.progress_percentage }}%</td>
                        <td class="py-2 px-2">{{ detail.overall_percentage|floatformat:2 }}%</td>
                        <td class="py-2 px-2 text-xs">{{ detail.last_accessed_material|date:"Y-m-d H:i:s"|default:"-" }}</td>
                        <td class="py-2 px-2 text-xs">{{ detail.last_completed_assessment|date:"Y-m-d H:i:s"|default:"-" }}</td>
                        <td class="py-2 px-2 text-xs">{{ detail.user.last_login|date:"Y-m-d H:i:s"|default:"-" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="16" class="text-center py-6 text-gray-500">
                            No registered participants.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Navigasi Halaman -->
    {% if enrollments.has_other_pages %}
    <nav class="mt-6" aria-label="Page navigation">
        <ul class="flex justify-center flex-wrap gap-1">
            <!-- First & Previous -->
            {% if enrollments.has_previous %}
            <li>
                <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}" 
                   class="w-9 h-9 rounded-full border border-gray-300 hover:bg-gray-100 flex items-center justify-center transition">
                    First
                </a>
            </li>
            <li>
                <a href="?page={{ enrollments.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}" 
                   class="w-9 h-9 rounded-full border border-gray-300 hover:bg-gray-100 flex items-center justify-center transition">
                    Previous
                </a>
            </li>
            {% else %}
            <li><span class="w-9 h-9 rounded-full border border-gray-200 text-gray-400 flex items-center justify-center">First</span></li>
            <li><span class="w-9 h-9 rounded-full border border-gray-200 text-gray-400 flex items-center justify-center">Previous</span></li>
            {% endif %}

            <!-- Page Numbers -->
            {% for num in enrollments.paginator.page_range %}
            {% if num >= enrollments.number|add:'-2' and num <= enrollments.number|add:'2' %}
            <li>
                <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}" 
                   class="w-9 h-9 rounded-full flex items-center justify-center transition
                   {% if enrollments.number == num %}bg-blue-600 text-white font-bold{% else %}border border-gray-300 hover:bg-gray-100{% endif %}">
                    {{ num }}
                </a>
            </li>
            {% endif %}
            {% endfor %}

            <!-- Next & Last -->
            {% if enrollments.has_next %}
            <li>
                <a href="?page={{ enrollments.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}" 
                   class="w-9 h-9 rounded-full border border-gray-300 hover:bg-gray-100 flex items-center justify-center transition">
                    Next
                </a>
            </li>
            <li>
                <a href="?page={{ enrollments.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}" 
                   class="w-9 h-9 rounded-full border border-gray-300 hover:bg-gray-100 flex items-center justify-center transition">
                    Last
                </a>
            </li>
            {% else %}
            <li><span class="w-9 h-9 rounded-full border border-gray-200 text-gray-400 flex items-center justify-center">Next</span></li>
            <li><span class="w-9 h-9 rounded-full border border-gray-200 text-gray-400 flex items-center justify-center">Last</span></li>
            {% endif %}
        </ul>
        <div class="text-center mt-3">
            <small class="text-gray-600">
                Halaman {{ enrollments.number }} dari {{ enrollments.paginator.num_pages }}
            </small>
        </div>
    </nav>
    {% endif %}

</section>

{% endblock %}