{% extends 'home/tes.html' %}
{% load static %}

{% block content %}

<section class="bg-white border border-gray-200 p-6 rounded-lg shadow-sm hover:shadow-md transition">
    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-6 md:p-8">

        <!-- Title -->
        <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
            <i class="fas fa-building text-yellow-500"></i>
            Personal Information 
        </h3>

    <!-- User Profile Card -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
        
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6 text-center">
            <h4 class="text-2xl font-bold">{{ user.get_full_name }}</h4>
        </div>

        <!-- Profile Photo -->
        <div class="flex justify-center -mt-12">
            {% if user.photo %}
                <img src="{{ user.photo.url }}" alt="User Photo" 
                     class="w-28 h-28 rounded-full border-4 border-white shadow-lg object-cover">
            {% else %}
                <img src="{% static 'images/default-avatar.png' %}" alt="Default Photo" 
                     class="w-28 h-28 rounded-full border-4 border-white shadow-lg object-cover">
            {% endif %}
        </div>

        <!-- Personal Info -->
        <div class="p-6 pt-16">
           

            <!-- Mobile List -->
            <div class="space-y-3 md:hidden">
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="font-medium text-gray-600 flex items-center gap-2">
                        Username
                    </span>
                    <span class="text-gray-800">{{ user.username }}</span>
                </div>
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="font-medium text-gray-600 flex items-center gap-2">
                        Email
                    </span>
                    <span class="text-gray-800">{{ user.email }}</span>
                </div>
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="font-medium text-gray-600 flex items-center gap-2">
                        First Name
                    </span>
                    <span class="text-gray-800">{{ user.first_name }}</span>
                </div>
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="font-medium text-gray-600 flex items-center gap-2">
                        Last Name
                    </span>
                    <span class="text-gray-800">{{ user.last_name }}</span>
                </div>
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="font-medium text-gray-600 flex items-center gap-2">
                        Gender
                    </span>
                    <span class="text-gray-800">{{ user.get_gender_display }}</span>
                </div>
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="font-medium text-gray-600 flex items-center gap-2">
                        Date of Birth
                    </span>
                    <span class="text-gray-800">{{ user.birth|date:"M d, ****" }}</span>
                </div>
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="font-medium text-gray-600 flex items-center gap-2">
                        Address
                    </span>
                    <span class="text-gray-800">{{ user.address|default:"-" }}</span>
                </div>
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="font-medium text-gray-600 flex items-center gap-2">
                        Country
                    </span>
                    <span class="text-gray-800">{{ user.country }}</span>
                </div>
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="font-medium text-gray-600 flex items-center gap-2">
                        Phone
                    </span>
                    <span class="text-gray-800">********{{ user.phone|slice:"-4:" }}</span>
                </div>
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="font-medium text-gray-600 flex items-center gap-2">
                        Education
                    </span>
                    <span class="text-gray-800">{{ user.get_education_display }}</span>
                </div>
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="font-medium text-gray-600 flex items-center gap-2">
                        University
                    </span>
                    <span class="text-gray-800">{{ user.university|default:"-" }}</span>
                </div>
            </div>

            <!-- Desktop Table -->
            <div class="hidden md:block overflow-x-auto">
                <table class="w-full text-sm">
                    <tbody class="divide-y divide-gray-200">
                        <tr><th class="py-3 px-4 text-left font-medium text-gray-600 w-48">Username</th><td class="py-3 px-4">{{ user.username }}</td></tr>
                        <tr><th class="py-3 px-4 text-left font-medium text-gray-600">Email</th><td class="py-3 px-4">{{ user.email }}</td></tr>
                        <tr><th class="py-3 px-4 text-left font-medium text-gray-600">First Name</th><td class="py-3 px-4">{{ user.first_name }}</td></tr>
                        <tr><th class="py-3 px-4 text-left font-medium text-gray-600">Last Name</th><td class="py-3 px-4">{{ user.last_name }}</td></tr>
                        <tr><th class="py-3 px-4 text-left font-medium text-gray-600">Gender</th><td class="py-3 px-4">{{ user.get_gender_display }}</td></tr>
                        <tr><th class="py-3 px-4 text-left font-medium text-gray-600">Date of Birth</th><td class="py-3 px-4">{{ user.birth|date:"M d, ****" }}</td></tr>
                        <tr><th class="py-3 px-4 text-left font-medium text-gray-600">Address</th><td class="py-3 px-4">{{ user.address|default:"-" }}</td></tr>
                        <tr><th class="py-3 px-4 text-left font-medium text-gray-600">Country</th><td class="py-3 px-4">{{ user.country }}</td></tr>
                        <tr><th class="py-3 px-4 text-left font-medium text-gray-600">Phone</th><td class="py-3 px-4">********{{ user.phone|slice:"-4:" }}</td></tr>
                        <tr><th class="py-3 px-4 text-left font-medium text-gray-600">Education</th><td class="py-3 px-4">{{ user.get_education_display }}</td></tr>
                        <tr><th class="py-3 px-4 text-left font-medium text-gray-600">University</th><td class="py-3 px-4">{{ user.university|default:"-" }}</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Search Courses -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
        <form method="GET" class="flex flex-col sm:flex-row gap-3">
            <input 
                type="text" 
                name="search" 
                placeholder="Search Courses" 
                value="{{ search_query }}"
                class="flex-1 px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
            <button type="submit" 
                    class="px-6 py-2.5 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2">
                Search
            </button>
        </form>
    </div>

    <!-- Enrolled Courses -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
        <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-5">
            <h5 class="text-xl font-bold">Enrolled Courses</h5>
        </div>
        <div class="p-6">

            <!-- Desktop Table -->
            <div class="hidden md:block overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-gray-50 border-b border-gray-200">
                        <tr>
                            <th class="py-3 px-4 text-left font-medium text-gray-700">Course Title</th>
                            <th class="py-3 px-4 text-left font-medium text-gray-700">Threshold</th>
                            <th class="py-3 px-4 text-left font-medium text-gray-700">Total Score</th>
                            <th class="py-3 px-4 text-left font-medium text-gray-700">Status</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        {% for course in course_details %}
                        <tr class="hover:bg-gray-50 transition">
                            <td class="py-3 px-4">{{ course.course_name }}</td>
                            <td class="py-3 px-4">{{ course.passing_threshold }}</td>
                            <td class="py-3 px-4">{{ course.total_score|floatformat:2 }} / {{ course.total_max_score }}</td>
                            <td class="py-3 px-4">
                                <span class="inline-flex px-3 py-1 rounded-full text-xs font-medium
                                    {% if course.status == 'Pass' %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                                    {{ course.status }}
                                </span>
                            </td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="4" class="py-8 text-center text-gray-500">No courses found.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Mobile Cards -->
            <div class="grid gap-4 md:hidden">
                {% for course in course_details %}
                <div class="bg-gray-50 rounded-xl p-4 border border-gray-200 hover:shadow-md transition">
                    <h6 class="font-semibold text-gray-800 mb-2">{{ course.course_name }}</h6>
                    <p class="text-sm text-gray-600 mb-1">
                        Score: <strong>{{ course.total_score|floatformat:2 }} / {{ course.total_max_score }}</strong>
                    </p>
                    <p class="text-sm">
                        Status:
                        <span class="inline-flex px-2 py-1 rounded-full text-xs font-medium ml-1
                            {% if course.status == 'Pass' %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                            {{ course.status }}
                        </span>
                    </p>
                </div>
                {% empty %}
                <p class="text-center text-gray-500 py-6">No courses found.</p>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if course_details.has_other_pages %}
            <nav class="flex justify-center mt-6 space-x-1">
                {% if course_details.has_previous %}
                <a href="?page={{ course_details.previous_page_number }}&search={{ search_query }}"
                   class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-300 hover:bg-gray-100 transition">
                    Previous
                </a>
                {% else %}
                <span class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-200 text-gray-400">Previous</span>
                {% endif %}

                {% for num in course_details.paginator.page_range %}
                <a href="?page={{ num }}&search={{ search_query }}"
                   class="w-10 h-10 flex items-center justify-center rounded-full text-sm font-medium transition
                   {% if course_details.number == num %}bg-blue-600 text-white{% else %}border border-gray-300 hover:bg-gray-100{% endif %}">
                    {{ num }}
                </a>
                {% endfor %}

                {% if course_details.has_next %}
                <a href="?page={{ course_details.next_page_number }}&search={{ search_query }}"
                   class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-300 hover:bg-gray-100 transition">
                    Next
                </a>
                {% else %}
                <span class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-200 text-gray-400">Next</span>
                {% endif %}
            </nav>
            {% endif %}
        </div>
    </div>

    <!-- Back Button -->
    <div class="text-center">
        <a href="{% url 'authentication:all-user' %}" 
           class="inline-flex items-center gap-2 px-6 py-3 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition">
            Back to Users List
        </a>
    </div>
</section>

{% endblock %}