{% extends 'home/tes.html' %}
{% load humanize %}
{% load static %}

{% block title %}Partners{% endblock %}

{% block content %}

<section class="bg-white border border-gray-200 p-6 rounded-lg shadow-sm hover:shadow-md transition">
<h1 class="text-3xl font-bold text-red-600 mb-4">Partner</h1>   

    {% if request.user.is_superuser or request.user.is_staff %}
    <div class="flex justify-between items-center mb-4">
        <div class="flex gap-2">
           <a href="{% url 'courses:partner_create_view' %}" class="bg-gray-800 text-white px-4 py-2 rounded-lg hover:bg-red-600 hover:text-white transition">
                Add Partner
            </a>
            <button class="bg-gray-800 text-white px-4 py-2 rounded-lg hover:bg-red-600 hover:text-white transition">
                Export
            </button>
            <a href="{% url 'partner:partner_analytics_admin' %}" class="bg-gray-800 text-white px-4 py-2 rounded-lg hover:bg-red-600 hover:text-white transition">
                <i class="bi bi-bar-chart-line"></i> Analytics
            </a>

        </div>
        <form class="flex gap-2" method="GET" action="">
            <input 
                class="form-input px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                type="search" 
                name="q" 
                value="{{ request.GET.q }}" 
                placeholder="Search Partner" 
                aria-label="Search">
            <button class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition" type="submit">
                Search
            </button>
        </form>
    </div>

    
    {% endif %}
    <div class="overflow-x-auto bg-white rounded-xl shadow-sm border">
  <table class="min-w-full text-sm text-gray-700">
    <!-- HEADER -->
    <thead class="bg-gray-50 sticky top-0 z-10 border-b">
      <tr class="text-left text-xs font-semibold uppercase tracking-wide text-gray-500">
        <th class="px-4 py-3">Name</th>
        <th class="px-4 py-3">Email</th>
        <th class="px-4 py-3">Phone</th>
        <th class="px-4 py-3 text-center">PKP</th>
        <th class="px-4 py-3 text-center">Verified</th>
        <th class="px-4 py-3">Type</th>
        <th class="px-4 py-3 text-right">Saldo</th>
        <th class="px-4 py-3 text-center">Courses</th>
        <th class="px-4 py-3 text-center">Learners</th>
        <th class="px-4 py-3 text-center">Instructors</th>
        <th class="px-4 py-3 text-center">Rating</th>
        <th class="px-4 py-3">Join</th>
        <th class="px-4 py-3 text-center">Actions</th>
      </tr>
    </thead>

    <!-- BODY -->
    <tbody class="divide-y">
      {% for p in partners %}
      <tr class="hover:bg-gray-50 transition">
        <!-- NAME -->
        <td class="px-4 py-3 font-medium text-gray-900">
          {{ p.name.name }}
        </td>

        <!-- EMAIL -->
        <td class="px-4 py-3 text-gray-600">
          {{ p.user.email }}
        </td>

        <!-- PHONE -->
        <td class="px-4 py-3">
          {{ p.phone|default:"-" }}
        </td>

        <!-- PKP -->
        <td class="px-4 py-3 text-center">
          {% if p.is_pkp %}
            <span class="px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700">
              PKP
            </span>
          {% else %}
            <span class="text-gray-400">—</span>
          {% endif %}
        </td>

        <!-- VERIFIED -->
        <td class="px-4 py-3 text-center">
          {% if p.is_verified %}
            <span class="inline-flex items-center gap-1 text-green-600 font-medium">
              ✔
            </span>
          {% else %}
            <span class="text-red-500">✖</span>
          {% endif %}
        </td>

        <!-- TYPE -->
        <td class="px-4 py-3">
          <span class="px-2 py-0.5 rounded-md text-xs font-medium bg-blue-50 text-blue-700">
            {{ p.get_business_type_display }}
          </span>
        </td>

        <!-- SALDO -->
        <td class="px-4 py-3 text-right font-semibold text-gray-900">
          {{ p.balance|floatformat:2 }}
        </td>

        <!-- COURSES -->
        <td class="px-4 py-3 text-center">
          {{ p.total_courses }}
        </td>

        <!-- LEARNERS -->
        <td class="px-4 py-3 text-center">
          {{ p.total_learners }}
        </td>

        <!-- INSTRUCTORS -->
        <td class="px-4 py-3 text-center">
          {{ p.total_instructors }}
        </td>

        <!-- RATING -->
        <td class="px-4 py-3 text-center">
          {% if p.average_rating %}
            <span class="inline-flex items-center gap-1">
              ⭐ <span>{{ p.average_rating }}</span>
            </span>
          {% else %}
            <span class="text-gray-400">—</span>
          {% endif %}
        </td>

        <!-- JOIN -->
        <td class="px-4 py-3 text-gray-500">
          {{ p.created_ad|date:"d M Y" }}
        </td>

        <!-- ACTION -->
        <td class="px-4 py-3 text-center flex justify-center gap-1">
            {% if request.user.is_superuser or request.user.is_staff %}
                <!-- Edit button -->
                <a href="{% url 'courses:update_partner' p.id %}" 
                class="bg-yellow-300 text-yellow-700 hover:bg-yellow-400 rounded p-1 transition"
                title="Edit">
                    <!-- Heroicons Pencil -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                            d="M11 17h2m-1-5v5m-6 0h6" />
                    </svg>
                </a>

                <!-- Review button -->
                <a href="{% url 'partner:verify_partner_detail' p.id %}" 
                class="bg-red-400 text-white hover:bg-red-500 rounded p-1 transition"
                title="Review">
                    <!-- Heroicons Search -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                            d="M8 16l4-4-4-4m5 8l4-4-4-4" />
                    </svg>
                </a>
            {% elif request.user.is_authenticated and request.user.is_partner %}
                <!-- Edit button for partner -->
                <a href="{% url 'partner:partner_update' p.id p.name.slug  %}" 
                class="bg-yellow-300 text-yellow-700 hover:bg-yellow-400 rounded p-1 transition"
                title="Edit">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                            d="M11 17h2m-1-5v5m-6 0h6" />
                    </svg>
                </a>
            {% endif %}

            <!-- Detail button -->
            <a href="{% url 'courses:partner_detail' p.id %}" 
            class="bg-blue-50 text-blue-600 border border-blue-200 hover:bg-blue-100 rounded p-1 transition"
            title="Detail">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                        d="M13 16h-1v-4h-1m1-4h.01M12 12h.01" />
                </svg>
            </a>
        </td>

      </tr>
      {% empty %}
      <tr>
        <td colspan="13" class="text-center py-8 text-gray-400">
          No partner data found
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<p class="mt-4 text-sm text-gray-600">
  Total: {{ page_obj.paginator.count }}
  &nbsp;|&nbsp;
  Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
</p>



{% if page_obj.paginator.num_pages > 1 %}
<div class="mt-6 flex justify-center">
  <nav class="inline-flex items-center gap-1 text-sm">

    <!-- PREV -->
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}"
         class="px-3 py-2 rounded-lg border hover:bg-gray-100">
        ‹ Prev
      </a>
    {% else %}
      <span class="px-3 py-2 rounded-lg border text-gray-400 cursor-not-allowed">
        ‹ Prev
      </span>
    {% endif %}

    <!-- PAGE NUMBERS -->
    {% for num in page_obj.paginator.page_range %}
      {% if num >= page_obj.number|add:-2 and num <= page_obj.number|add:2 %}
        {% if num == page_obj.number %}
          <span class="px-3 py-2 rounded-lg bg-blue-600 text-white font-semibold">
            {{ num }}
          </span>
        {% else %}
          <a href="?page={{ num }}{% if query %}&q={{ query }}{% endif %}"
             class="px-3 py-2 rounded-lg border hover:bg-gray-100">
            {{ num }}
          </a>
        {% endif %}
      {% endif %}
    {% endfor %}

    <!-- NEXT -->
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}"
         class="px-3 py-2 rounded-lg border hover:bg-gray-100">
        Next ›
      </a>
    {% else %}
      <span class="px-3 py-2 rounded-lg border text-gray-400 cursor-not-allowed">
        Next ›
      </span>
    {% endif %}

  </nav>
</div>
{% endif %}



    
</section>

{% endblock %}
