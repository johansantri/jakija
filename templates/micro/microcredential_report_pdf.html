<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Laporan Microcredential - {{ micro.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 p-6 font-sans">

    <h1 class="text-2xl font-bold text-blue-600 mb-4">Microcredential Report</h1>

    <!-- Info Table -->
    <div class="bg-white shadow-md rounded-lg p-4 mb-6">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
                <p class="mb-1"><strong>Microcredential Title:</strong> {{ micro.title }}</p>
                <p class="mb-1"><strong>Microcredential ID:</strong> {{ micro.id }}</p>
            </div>
            <div>
                <p class="mb-1"><strong>Date:</strong> {{ current_date|date:"d M Y" }}</p>
                <p class="mb-1"><strong>Minimum Total Score:</strong> {{ micro.min_total_score|floatformat:0 }}</p>
            </div>
        </div>
    </div>

    <!-- Participants Table -->
    <h2 class="text-xl font-semibold mb-3">Participants</h2>
    <div class="overflow-x-auto bg-white shadow-md rounded-lg">
        <table class="min-w-full border border-gray-200">
            <thead class="bg-blue-100 text-left text-gray-700">
                <tr>
                    <th class="px-4 py-2 border-b">Name & Email</th>
                    <th class="px-4 py-2 border-b">University</th>
                    <th class="px-4 py-2 border-b">Country / Gender</th>
                    <th class="px-4 py-2 border-b">Score</th>
                    <th class="px-4 py-2 border-b">Status</th>
                    <th class="px-4 py-2 border-b">Certificate</th>
                    <th class="px-4 py-2 border-b">Courses</th>
                </tr>
            </thead>
            <tbody>
                {% for p in participants %}
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-2 border-b">
                        <strong>{{ p.full_name }}</strong><br>
                        <small class="text-gray-500">{{ p.email }}</small>
                    </td>
                    <td class="px-4 py-2 border-b">{{ p.university }}</td>
                    <td class="px-4 py-2 border-b">{{ p.country }}<br>{{ p.gender }}</td>
                    <td class="px-4 py-2 border-b">{{ p.total_user_score }} / {{ p.total_max_score }}</td>
                    <td class="px-4 py-2 border-b">
                        <span class="px-2 py-1 rounded-full text-white text-sm {% if p.microcredential_passed %}bg-green-600{% else %}bg-red-600{% endif %}">
                            {% if p.microcredential_passed %}Passed{% else %}Failed{% endif %}
                        </span>
                    </td>
                    <td class="px-4 py-2 border-b text-sm">
                        {% if p.certificate_id != "N/A" %}
                            {{ p.certificate_id }}<br>
                            <span class="text-gray-500 text-xs">{{ p.issued_at|date:"Y-m-d" }}</span>
                        {% else %}
                            None
                        {% endif %}
                    </td>
                    <td class="px-4 py-2 border-b">
                        <ul class="divide-y divide-gray-200">
                            {% for course in p.course_progress %}
                            <li class="py-1">
                                <strong>{{ course.course_name }}</strong>: 
                                Score {{ course.user_score }}/{{ course.max_score }}, 
                                Min: {{ course.min_score }},
                                <span class="px-1 rounded text-white text-xs {% if course.passed %}bg-green-600{% else %}bg-red-600{% endif %}">
                                    {% if course.passed %}Passed{% else %}Failed{% endif %}
                                </span>
                            </li>
                            {% empty %}
                            <li class="py-1 text-gray-500">No course data available</li>
                            {% endfor %}
                        </ul>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</body>
</html>
