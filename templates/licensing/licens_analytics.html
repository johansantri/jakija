{% extends 'home/tes.html' %}

{% block content %}

<div class="flex justify-between items-center mb-3">
    <div>
        <h2 class="mb-0 text-2xl font-semibold">Invitation Analytics</h2>
        <p class="text-gray-500 mb-0">Statistics and list of invitations that have been sent.</p>
    </div>
    <a href="{% url 'licensing:send_invitation' %}" class="btn bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 flex items-center">
        Invite Learners
        <i class="bi bi-person-plus ml-2" aria-hidden="true"></i>
    </a>
</div>

<!-- Invitation Statistics -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
    <div>
        <div class="bg-white p-4 rounded-lg shadow text-center">
            <h5 class="font-medium">Pending</h5>
            <p class="text-xl text-gray-800">{{ invitation_stats.pending }}</p>
        </div>
    </div>
    <div>
        <div class="bg-white p-4 rounded-lg shadow text-center">
            <h5 class="font-medium">Accepted</h5>
            <p class="text-xl text-gray-800">{{ invitation_stats.accepted }}</p>
        </div>
    </div>
    <div>
        <div class="bg-white p-4 rounded-lg shadow text-center">
            <h5 class="font-medium">Expired</h5>
            <p class="text-xl text-gray-800">{{ invitation_stats.expired }}</p>
        </div>
    </div>
</div>

<!-- Search and Filter Form -->
<form method="GET" class="mb-4">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
            <input type="text" name="search_query" class="form-input w-full p-2 border border-gray-300 rounded-md" placeholder="Search by email" value="{{ search_query }}">
        </div>
        <div>
            <select name="status" class="form-select w-full p-2 border border-gray-300 rounded-md">
                <option value="">All Statuses</option>
                <option value="pending" {% if status == 'pending' %}selected{% endif %}>Pending</option>
                <option value="accepted" {% if status == 'accepted' %}selected{% endif %}>Accepted</option>
                <option value="expired" {% if status == 'expired' %}selected{% endif %}>Expired</option>
            </select>
        </div>
        <div>
            <button type="submit" class="btn bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">Search</button>
        </div>
    </div>
</form>

<!-- Invitation List -->
<div class="overflow-x-auto">
    <table class="min-w-full table-auto bg-white border border-gray-300 rounded-md">
        <thead>
            <tr class="bg-gray-100">
                <th class="px-4 py-2 border-b text-left">Invitee Email</th>
                <th class="px-4 py-2 border-b text-left">Status</th>
                <th class="px-4 py-2 border-b text-left">Sent Date</th>
                <th class="px-4 py-2 border-b text-left">Expiry Date</th>
                <th class="px-4 py-2 border-b text-left">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for invitation in invitations %}
            <tr class="border-b hover:bg-gray-50">
                <td class="px-4 py-2">{{ invitation.invitee_email }}</td>
                <td class="px-4 py-2">{{ invitation.status|title }}</td>
                <td class="px-4 py-2">{{ invitation.invitation_date|date:"d M Y" }}</td>
                <td class="px-4 py-2">{{ invitation.expiry_date|date:"d M Y" }}</td>
                <td class="px-4 py-2">
                    {% if invitation.status == 'pending' %}
                    <a href="{% url 'licensing:cancel_invitation' invitation.id %}" class="btn bg-red-500 text-white px-3 py-1 rounded-md hover:bg-red-600">Cancel</a>
                    {% elif invitation.status == 'accepted' %}
                    <a href="{% url 'licensing:delete_invitation' invitation.id %}" class="btn bg-yellow-500 text-white px-3 py-1 rounded-md hover:bg-yellow-600">Delete</a>
                    {% elif invitation.status == 'expired' %}
                    <a href="{% url 'licensing:resend_invitation' invitation.id %}" class="btn bg-blue-500 text-white px-3 py-1 rounded-md hover:bg-blue-600">Resend</a>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="text-center py-4">No invitations found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if invitations.has_other_pages %}
<nav class="mt-4" aria-label="Page navigation">
    <ul class="pagination flex justify-center space-x-2">
        {% if invitations.has_previous %}
        <li>
            <a class="page-link text-blue-500 hover:text-blue-700" href="?page={{ invitations.previous_page_number }}{% if status %}&status={{ status }}{% endif %}{% if search_query %}&search_query={{ search_query }}{% endif %}">&laquo; Previous</a>
        </li>
        {% endif %}
        {% for num in invitations.paginator.page_range %}
        <li>
            <a class="page-link px-3 py-1 rounded-md {% if invitations.number == num %}bg-blue-500 text-white{% else %}text-blue-500 hover:bg-blue-200{% endif %}" href="?page={{ num }}{% if status %}&status={{ status }}{% endif %}{% if search_query %}&search_query={{ search_query }}{% endif %}">{{ num }}</a>
        </li>
        {% endfor %}
        {% if invitations.has_next %}
        <li>
            <a class="page-link text-blue-500 hover:text-blue-700" href="?page={{ invitations.next_page_number }}{% if status %}&status={{ status }}{% endif %}{% if search_query %}&search_query={{ search_query }}{% endif %}">Next &raquo;</a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% endblock %}
