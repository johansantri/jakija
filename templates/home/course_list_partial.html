{% load static %}
{% load humanize %}

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for course in courses %}
        <article class="bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow flex flex-col overflow-hidden">
            <a href="{% url 'courses:course_lms_detail' course.course_id course.course_slug %}" 
               title="{{ course.course_name }}" 
               class="block flex-grow flex flex-col">

                <!-- Thumbnail -->
                <div class="relative overflow-hidden">
                    <img src="{{ course.course_image }}" 
                        alt="{{ course.course_name }}"
                        class="w-full aspect-[4/3] object-cover transition-transform duration-300 hover:scale-105">

                    {% if course.is_free %}
                        <span class="absolute top-2 left-2 bg-green-500 text-white text-xs font-semibold px-2 py-1 rounded-md shadow">FREE</span>
                    {% else %}
                        <span class="absolute top-2 left-2 bg-blue-500 text-white text-xs font-semibold px-2 py-1 rounded-md shadow">
                            IDR {{ course.price|intcomma }}
                        </span>
                    {% endif %}
                </div>

                <!-- Body -->
                <div class="p-4 flex flex-col flex-grow">
                    <!-- Title -->
                    <h2 class="text-base font-semibold text-gray-900 line-clamp-2 mb-1 hover:text-green-600 transition-colors duration-200">
                        {{ course.course_name }}
                    </h2>

                    <!-- Category & Level -->
                    <p class="text-xs text-gray-500 mb-2 truncate">{{ course.category }} | {{ course.level }}</p>

                    <!-- Rating & Enrollments -->
                    <div class="flex items-center justify-between text-xs text-gray-500 mb-2">
                        <div class="flex items-center space-x-1">
                            {% for i in course.full_star_range %}
                                <svg class="h-4 w-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 15l-5.878 3.09L5.49 12.18 1 7.91l6.061-.545L10 2.5l2.939 4.865 6.061.545-4.49 4.27 1.368 5.91z"></path>
                                </svg>
                            {% endfor %}
                            {% if course.half_star %}
                                <svg class="h-4 w-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 15l-5.878 3.09L5.49 12.18 1 7.91l6.061-.545L10 2.5l2.939 4.865 6.061.545-4.49 4.27 1.368 5.91z"></path>
                                </svg>
                            {% endif %}
                            <span>({{ course.review_count }})</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M20 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M4 21v-2a4 4 0 0 1 3-3.87"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            <span>{{ course.num_enrollments }}</span>
                        </div>
                    </div>

                    <!-- Language -->
                    <p class="text-xs text-gray-400 mb-4 truncate flex items-center space-x-1">
                        <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="2" y1="12" x2="22" y2="12"></line>
                            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                        </svg>
                        <span>{{ course.language }}</span>
                    </p>

                    <!-- Footer: Instructor & Partner -->
                    <div class="flex items-center mt-auto pt-3 border-t border-gray-100">
                        <img src="{{ course.org_logo }}" alt="{{ course.partner }}" 
                             class="w-6 h-6 rounded-full mr-3 object-cover border border-gray-200">
                        <div class="flex flex-col text-xs leading-tight truncate">
                            <p class="text-gray-700 font-semibold truncate">{{ course.partner }}</p>
                            <p class="text-gray-500 truncate">{{ course.instructor }}</p>
                        </div>
                    </div>
                </div>
            </a>
        </article>
    {% empty %}
        <div class="col-span-full text-center text-gray-500">
            No courses found.
        </div>
    {% endfor %}
</div>


<!-- Pagination -->
<nav class="mt-6 flex justify-center">
    <ul class="flex gap-2 flex-wrap justify-center">
        {% if page_obj.has_previous %}
            <li>
                <a hx-get="?page={{ page_obj.previous_page_number }}" hx-target="#course-list"
                   class="px-3 py-1 border rounded hover:bg-red-600 hover:text-white">‹</a>
            </li>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
            {% if num >= page_obj.number|add:-2 and num <= page_obj.number|add:2 %}
                <li>
                    <a hx-get="?page={{ num }}" hx-target="#course-list"
                       class="px-3 py-1 border rounded {% if page_obj.number == num %}bg-red-600 text-white{% else %}text-red-600 hover:bg-red-600 hover:text-white{% endif %}">
                       {{ num }}
                    </a>
                </li>
            {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
            <li>
                <a hx-get="?page={{ page_obj.next_page_number }}" hx-target="#course-list"
                   class="px-3 py-1 border rounded hover:bg-red-600 hover:text-white">›</a>
            </li>
        {% endif %}
    </ul>
</nav>
