<div class="bg-white border border-gray-200 rounded-xl p-4 {% if not post.parent %}mb-3{% endif %}" 
     style="{% if post.parent %}margin-left: 20px;{% endif %}">

    <div class="flex">  <!-- flex untuk avatar + konten -->
        
        <!-- Avatar User -->
        <div class="flex-shrink-0 mr-2">
            {% if post.user.photo %}
                <img src="{{ post.user.photo.url }}" 
                     alt="{{ post.user.username }}'s avatar" 
                     class="rounded-full" 
                     width="32" 
                     height="32" 
                     style="object-fit: cover;">
            {% else %}
                <!-- Fallback: Initials -->
                <div class="rounded-full flex items-center justify-center bg-blue-600 text-white font-bold text-xs" 
                     style="width:32px; height:32px;">
                    {{ post.user.first_name|first|upper }}{{ post.user.last_name|first|upper|default:post.user.username|first|upper }}
                </div>
            {% endif %}
        </div>
        
        <!-- Konten Postingan -->
        <div class="flex-grow">
            <!-- Header: Username + Waktu -->
            <div class="flex items-center gap-2 mb-1">
                <strong class="text-gray-700">{{ post.user.username }}</strong>
                <small class="text-gray-400">· {{ post.created_at|date:"d M Y" }} · {{ post.created_at|time:"H:i" }}</small>
            </div>

            {% if post.parent %}
                <small class="text-gray-400 block mb-1">Balasan untuk @{{ post.parent.user.username }}</small>
            {% endif %}

            <p class="mb-2 text-gray-600">{{ post.content }}</p>

            <div class="flex items-center gap-4">
                <!-- Like/Unlike -->
                <div id="like-{{ post.id }}">
                    {% if post.liked %}
                        <button hx-post="{% url 'courses:like_post' post_id=post.id %}" 
                                hx-target="#like-{{ post.id }}" 
                                hx-swap="outerHTML" 
                                class="p-0 text-red-600 hover:text-red-700 flex items-center gap-1" 
                                aria-label="Unlike post">
                            <i class="fas fa-heart"></i> <span>{{ post.like_count }}</span>
                        </button>
                    {% else %}
                        <button hx-post="{% url 'courses:like_post' post_id=post.id %}" 
                                hx-target="#like-{{ post.id }}" 
                                hx-swap="outerHTML" 
                                class="p-0 text-gray-400 hover:text-gray-600 flex items-center gap-1" 
                                aria-label="Like post">
                            <i class="far fa-heart"></i> <span>{{ post.like_count }}</span>
                        </button>
                    {% endif %}
                </div>

                <!-- Tombol Reply -->
                <button class="p-0 text-blue-500 hover:text-blue-700 flex items-center" 
                        hx-get="{% url 'courses:reply_form' post_id=post.id %}" 
                        hx-target="#reply-form-{{ post.id }}" 
                        hx-swap="innerHTML">
                        <i class="fa fa-reply" aria-hidden="true"></i>
                </button>
            </div>

            <!-- Wadah Form Reply -->
            <div id="reply-form-{{ post.id }}" class="mt-2"></div>

            <!-- Tampilkan Balasan -->
            <div id="replies-{{ post.id }}" class="mt-2 space-y-2">
                {% for reply in post.replies.all %}
                    {% include 'home/post_item.html' with post=reply %}
                {% endfor %}
            </div>
        </div>
    </div>
</div>
