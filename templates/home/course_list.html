{% extends 'home/base.html' %}
{% load static %}
{% load humanize %}
{% load extra_filters %}
{% block meta %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="Explore a wide range of online courses on JakIja, designed to enhance your skills and knowledge with expert instructors.">
    <meta name="keywords" content="Online Courses, E-learning, JakIja, Digital Education, Skill Development">
    <meta name="author" content="JakIja Team">
    <link rel="canonical" href="{{ request.build_absolute_uri }}">
    <title>Course List - JakIja</title>

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Course List - JakIja">
    <meta property="og:description" content="Explore a wide range of online courses on JakIja, designed to enhance your skills and knowledge.">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:image" content="{% static 'assets/img/course-cover.jpg' %}">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Course List - JakIja">
    <meta name="twitter:description" content="Explore a wide range of online courses on JakIja, designed to enhance your skills and knowledge.">
    <meta name="twitter:image" content="{% static 'assets/img/course-cover.jpg' %}">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Course List - JakIja",
      "description": "Explore a wide range of online courses on JakIja, designed to enhance your skills and knowledge with expert instructors.",
      "url": "{{ request.build_absolute_uri }}"
    }
    </script>
{% endblock meta %}

{% block content %}
<section class="py-8 bg-white font-sans">
  <div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
      <!-- Main Content -->
      <div class="lg:col-span-9">
        <!-- COURSE GRID -->
        <div id="course-list">
          {% include "home/course_list_partial.html" %}
        </div>

        <!-- Mobile Filter (tampil di bawah konten di mobile) -->
        <div class="lg:hidden mt-8 p-4 bg-gray-50 rounded-lg shadow-md">
          <form method="GET"
                hx-get="{% url 'authentication:course_list' %}"
                hx-target="#course-list"
                hx-swap="innerHTML"
                class="flex flex-col space-y-4">

            <h3 class="font-semibold text-lg mb-2 border-b pb-1">Filter Courses</h3>

            <div>
              <label class="block font-medium mb-1">Categories</label>
              <div class="max-h-40 overflow-y-auto border rounded p-2 bg-white">
                {% for category in categories %}
                  <label class="flex items-center space-x-2 mb-1 cursor-pointer">
                    <input type="checkbox" name="category" value="{{ category.id }}"
                           {% if category.id|stringformat:"s" in category_filter %}checked{% endif %}
                           class="form-checkbox text-red-600">
                    <span class="text-sm">{{ category.name }} ({{ category.course_count }})</span>
                  </label>
                {% endfor %}
              </div>
            </div>

            <div>
              <label class="block font-medium mb-1" for="language-select">Language</label>
              <select id="language-select" name="language" class="w-full border rounded px-3 py-2">
                <option value="">All</option>
                {% for lang in language_options %}
                  <option value="{{ lang.code }}" {% if lang.code == language_filter %}selected{% endif %}>{{ lang.name }}</option>
                {% endfor %}
              </select>
            </div>

            <div>
              <label class="block font-medium mb-1" for="level-select">Level</label>
              <select id="level-select" name="level" class="w-full border rounded px-3 py-2">
                <option value="">All</option>
                {% for level in level_options %}
                  <option value="{{ level.code }}" {% if level.code == level_filter %}selected{% endif %}>{{ level.name }}</option>
                {% endfor %}
              </select>
            </div>

            <div>
              <label class="block font-medium mb-1" for="price-select">Price</label>
              <select id="price-select" name="price" class="w-full border rounded px-3 py-2">
                <option value="">All</option>
                {% for p in price_options %}
                  <option value="{{ p.code }}" {% if p.code == price_filter %}selected{% endif %}>{{ p.name }}</option>
                {% endfor %}
              </select>
            </div>

            <button type="submit" class="bg-red-600 text-white font-semibold rounded px-4 py-2 hover:bg-red-700 transition-colors">
              Apply Filters
            </button>
          </form>
        </div>
      </div>

      <!-- Sidebar Filter Desktop -->
      <aside class="hidden lg:block lg:col-span-3 bg-gray-50 p-6 rounded-lg shadow-md sticky top-20 h-fit">
        <form method="GET"
              hx-get="{% url 'authentication:course_list' %}"
              hx-target="#course-list"
              hx-swap="innerHTML"
              class="flex flex-col space-y-6">

          <h3 class="font-semibold text-xl border-b pb-2">Filter Courses</h3>

          <div>
            <label class="block font-medium mb-2">Categories</label>
            {% for category in categories %}
              <label class="flex items-center space-x-2 mb-2 cursor-pointer">
                <input type="checkbox" name="category" value="{{ category.id }}"
                       {% if category.id|stringformat:"s" in category_filter %}checked{% endif %}
                       class="form-checkbox text-red-600">
                <span>{{ category.name }} ({{ category.course_count }})</span>
              </label>
            {% endfor %}
          </div>

          <div>
            <label class="block font-medium mb-2" for="language-select-desktop">Language</label>
            <select id="language-select-desktop" name="language" class="w-full border rounded px-3 py-2">
              <option value="">All</option>
              {% for lang in language_options %}
                <option value="{{ lang.code }}" {% if lang.code == language_filter %}selected{% endif %}>{{ lang.name }}</option>
              {% endfor %}
            </select>
          </div>

          <div>
            <label class="block font-medium mb-2" for="level-select-desktop">Level</label>
            <select id="level-select-desktop" name="level" class="w-full border rounded px-3 py-2">
              <option value="">All</option>
              {% for level in level_options %}
                <option value="{{ level.code }}" {% if level.code == level_filter %}selected{% endif %}>{{ level.name }}</option>
              {% endfor %}
            </select>
          </div>

          <div>
            <label class="block font-medium mb-2" for="price-select-desktop">Price</label>
            <select id="price-select-desktop" name="price" class="w-full border rounded px-3 py-2">
              <option value="">All</option>
              {% for p in price_options %}
                <option value="{{ p.code }}" {% if p.code == price_filter %}selected{% endif %}>{{ p.name }}</option>
              {% endfor %}
            </select>
          </div>

          <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded-lg mt-2 hover:bg-red-700 transition-colors">
            Apply Filters
          </button>
        </form>
      </aside>
    </div>
  </div>
</section>


<!-- Schema Markup for SEO -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "ItemList",
    "@id": "{{ request.build_absolute_uri|escapejs }}#courseList",
    "name": "Course List",
    "description": "A list of available courses on the platform.",
    "itemListElement": [
        {% for course in courses %}
        {
            "@type": "Course",
            "@id": "{{ request.build_absolute_uri|escapejs }}{% url 'courses:course_lms_detail' course.course_id course.course_slug %}#course",
            "name": "{{ course.course_name|escapejs }}",
            "description": "{{ course.course_description|truncatewords:30|escapejs|default:'Course description not available' }}",
            "provider": {
                "@type": "Organization",
                "name": "{{ course.partner|escapejs|default:'Unknown' }}"
            },
            "image": "{{ course.course_image|escapejs|default:'/media/default.jpg' }}",
            "aggregateRating": {
                "@type": "AggregateRating",
                "ratingValue": "{{ course.average_rating }}",
                "reviewCount": "{{ course.review_count }}"
            },
            "offers": {
                "@type": "Offer",
                "price": "{{ course.price }}",
                "priceCurrency": "IDR"
            },
            "url": "{{ request.build_absolute_uri|escapejs }}{% url 'courses:course_lms_detail' course.course_id course.course_slug %}"
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ]
}
</script>
{% endblock %}